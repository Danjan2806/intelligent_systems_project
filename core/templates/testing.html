{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="hero py-5">
    <div class="container text-center">
        <h1 class="fs-3 fs-md-2 fs-lg-1">Тестирование проекта</h1>
        <p class="fs-6 fs-md-5 fs-lg-4">Демонстрация базового тестирования и проверки функционала сайта</p>
    </div>
</section>

<div class="container mt-5">
    <div class="row g-4">
        {% for test in tests %}
        <div class="col-12 col-sm-6">
            <div class="glass-card h-100 d-flex flex-column p-3">
                <h5>{{ test.title }}</h5>

                {% if test.images.all %}
                <div id="carousel-{{ test.id }}" class="carousel slide mb-3" data-bs-ride="carousel">
                    <div class="carousel-inner rounded">
                        {% for img in test.images.all %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ img.image.url }}" class="d-block w-100 carousel-img" 
                                 style="cursor:pointer;" onclick="openImagePopup('{{ img.image.url }}')">
                        </div>
                        {% endfor %}
                    </div>

                    <div class="carousel-indicators mt-2">
                        {% for img in test.images.all %}
                        <button type="button" data-bs-target="#carousel-{{ test.id }}" data-bs-slide-to="{{ forloop.counter0 }}"
                                class="carousel-indicator {% if forloop.first %}active{% endif %}" 
                                aria-current="{% if forloop.first %}true{% endif %}" 
                                aria-label="Slide {{ forloop.counter }}"></button>
                        {% endfor %}
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel-{{ test.id }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel-{{ test.id }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                {% endif %}

                <p class="mt-2"><strong>Описание теста:</strong> {{ test.description }}</p>
                <p><strong>Результат:</strong> {{ test.result }}</p>
            </div>
        </div>
        {% empty %}
        <p class="text-center">Тесты ещё не добавлены.</p>
        {% endfor %}
    </div>
</div>

<!-- Заголовок и широкая карточка Git -->
<div class="container mt-5">
    <!-- Заголовок -->
    <h2 class="fs-4 fs-md-3 fs-lg-2 text-center mb-4">Контроль версий Git</h2>

    <!-- Широкая карточка: Git -->
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <div class="glass-card h-100 d-flex flex-column p-4">

                <!-- Слайдер -->
                {% if git_test.images.all %}
                <div id="carousel-git" class="carousel slide mb-4" data-bs-ride="carousel">
                    <div class="carousel-inner rounded">
                        {% for img in git_test.images.all %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ img.image.url }}" class="d-block w-100 carousel-img" 
                                 style="cursor:pointer;" onclick="openImagePopup('{{ img.image.url }}')">
                        </div>
                        {% endfor %}
                    </div>

                    <div class="carousel-indicators mt-2">
                        {% for img in git_test.images.all %}
                        <button type="button" data-bs-target="#carousel-git" data-bs-slide-to="{{ forloop.counter0 }}"
                                class="carousel-indicator {% if forloop.first %}active{% endif %}" 
                                aria-current="{% if forloop.first %}true{% endif %}" 
                                aria-label="Slide {{ forloop.counter }}"></button>
                        {% endfor %}
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel-git" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel-git" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                {% endif %}

                <!-- Текстовое описание и результат -->
                <div class="text-start" style="max-width: 100%; margin: 0 auto;">
                    <p><strong>Описание:</strong> Демонстрация интеграции Git для контроля версий проекта, включая создание репозитория, коммиты, ветвления и слияния.</p>
                    <p><strong>Ссылка на репозиторий:</strong> <a href="https://github.com/Danjan2806/intelligent_systems_project" target="_blank">https://github.com/Danjan2806/intelligent_systems_project</a></p>
                    <p><strong>Результат:</strong> Все изменения проекта отслеживаются через Git, ветки и коммиты видны, слияния выполняются корректно.</p>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Popup для увеличенного изображения -->
<div id="imagePopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
     background:rgba(0,0,0,0.8); z-index:1050; justify-content:center; align-items:center;">
    <div style="position:relative; max-width:90%; max-height:90%;">
        <button onclick="closeImagePopup()" style="position:absolute; top:10px; right:10px; z-index:10;" 
                class="btn btn-danger btn-sm">✖</button>
        <img id="popupImage" src="" style="width:100%; height:auto; border-radius:10px;">
    </div>
</div>

<style>
/* Слайдер и карточка */
.carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 8px;
}
.carousel-indicators button.carousel-indicator {
    width: 12px !important;
    height: 12px !important;
    border-radius: 50% !important;
    background-color: rgba(255, 255, 255, 0.5);
    border: none;
}
.carousel-indicators button.carousel-indicator.active {
    background-color: rgba(255, 255, 255, 1);
}
.carousel-img {
    object-fit: cover;
    max-height: 250px;
}

/* Popup */
#imagePopup {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    z-index:1050;
    justify-content:center;
    align-items:center;
}

/* Адаптация под разные экраны */
@media (max-width: 1024px) {
    .carousel-img { max-height: 220px; }
}
@media (max-width: 768px) {
    .carousel-img { max-height: 200px; }
}
@media (max-width: 375px) {
    .carousel-img { max-height: 150px; }
}
</style>

<script>
function openImagePopup(url) {
    document.getElementById('popupImage').src = url;
    document.getElementById('imagePopup').style.display = 'flex';
}
function closeImagePopup() {
    document.getElementById('popupImage').src = '';
    document.getElementById('imagePopup').style.display = 'none';
}
</script>
{% endblock %}