{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="hero py-5">
    <div class="container text-center">
        <h1 class="fs-3 fs-md-2 fs-lg-1">Управление проектом</h1>
        <p class="fs-6 fs-md-5 fs-lg-4">Демонстрация эволюции проекта и работы по Agile/Kanban</p>
    </div>
</section>

<div class="container mt-5">
    <div class="row g-4">
        {% for update in updates %}
        <div class="col-12 col-sm-6 col-md-4">
            <div class="glass-card h-100 d-flex flex-column">
                
                {% if update.images.all %}
                <div id="carousel-{{ update.id }}" class="carousel slide mb-3" data-bs-ride="carousel">
                    <div class="carousel-inner rounded">
                        {% for img in update.images.all %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ img.image.url }}" class="d-block w-100 carousel-img" alt="Update image {{ forloop.counter }}" 
                                 style="cursor:pointer;" onclick="openImagePopup('{{ img.image.url }}')">
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Индикаторы -->
                    <div class="carousel-indicators mt-2">
                        {% for img in update.images.all %}
                        <button type="button" data-bs-target="#carousel-{{ update.id }}" data-bs-slide-to="{{ forloop.counter0 }}"
                                class="carousel-indicator {% if forloop.first %}active{% endif %}" 
                                aria-current="{% if forloop.first %}true{% endif %}" 
                                aria-label="Slide {{ forloop.counter }}"></button>
                        {% endfor %}
                    </div>

                    <!-- Навигация -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel-{{ update.id }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel-{{ update.id }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                {% endif %}

                <h5 class="mt-2">{{ update.title }}</h5>
                {% if update.description %}
                <p class="flex-grow-1">{{ update.description }}</p>
                {% endif %}
                {% if update.created_at %}
                <small class="text-muted">Дата: {{ update.created_at|date:"d.m.Y" }}</small>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p class="text-center">Этапы проекта пока не добавлены.</p>
        {% endfor %}
    </div>
</div>

<!-- Секция с планом проекта -->
<section class="container mt-5">
    <div class="text-center mb-5">
        <h2 class="fw-bold display-6">План проекта</h2>
        <p class="lead">Подробное описание этапов, объема работ, сроков и прогресса разработки</p>
    </div>

    <!-- 1. Общий обзор проекта -->
    <div class="glass-card mb-4 p-4">
        <h3 class="fw-semibold mb-3">Общий обзор проекта</h3>
        <p>Проект представляет собой веб-приложение для управления презентационными материалами с возможностью:</p>
        <ul>
            <li>Хранения PDF-презентаций;</li>
            <li>Просмотра файлов в браузере;</li>
            <li>Скачивания документов;</li>
            <li>Визуализации прогресса проекта через Agile/Kanban доску;</li>
            <li>Отслеживания изменений через систему контроля версий Git.</li>
        </ul>
        <p><strong>Цель проекта:</strong> показать процесс разработки веб-приложения от планирования до финализации, включая проектирование, разработку, тестирование и документацию.</p>
    </div>

    <!-- 2. Объем работ -->
    <div class="glass-card mb-4 p-4">
        <h3 class="fw-semibold mb-3">Объем работ</h3>
        <ol>
            <li><strong>Проектирование и организация:</strong>
                <ul>
                    <li>Создание структуры проекта Django (<code>settings.py</code>, <code>urls.py</code>, <code>templates</code>, <code>static</code>, <code>media</code>);</li>
                    <li>Подключение и настройка базы данных;</li>
                    <li>Планирование страниц сайта и навигации;</li>
                    <li>Создание репозитория Git, настройка <code>.gitignore</code>, первый коммит, README.</li>
                </ul>
            </li>
            <li><strong>Backend-разработка:</strong>
                <ul>
                    <li>Создание модели <code>Presentation</code> и миграции базы данных;</li>
                    <li>Реализация функционала загрузки и сохранения 10 презентаций;</li>
                    <li>Реализация отображения списка презентаций;</li>
                    <li>Просмотр PDF через встроенный просмотрщик;</li>
                    <li>Настройка скачивания файлов с проверкой MIME-типов.</li>
                </ul>
            </li>
            <li><strong>Frontend-разработка:</strong>
                <ul>
                    <li>Создание всех страниц проекта;</li>
                    <li>Подключение Bootstrap для сетки и адаптивности;</li>
                    <li>Настройка слайдеров для этапов проекта;</li>
                    <li>Адаптация дизайна под разрешения 1920px, 1024px, 768px, 375px.</li>
                </ul>
            </li>
            <li><strong>Управление проектом и документация:</strong>
                <ul>
                    <li>Ведение Kanban-доски в Agile;</li>
                    <li>Создание описания плана проекта и этапов;</li>
                    <li>Документирование всех действий, контроль версий;</li>
                    <li>Подготовка итоговой документации.</li>
                </ul>
            </li>
            <li><strong>Тестирование:</strong>
                <ul>
                    <li>Проверка всех страниц на корректное отображение;</li>
                    <li>Проверка функционала загрузки и просмотра PDF;</li>
                    <li>Проверка адаптивности;</li>
                    <li>Автоматические тесты списка и detail view презентаций.</li>
                </ul>
            </li>
        </ol>
    </div>

    <!-- 3. Сроки выполнения -->
    <div class="glass-card mb-4 p-4">
        <h3 class="fw-semibold mb-3">Сроки выполнения</h3>
        <div class="table-responsive">
            <table class="table table-striped table-bordered mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>Неделя</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Неделя 1</td>
                        <td>Планирование проекта: структура проекта, Git-репозиторий, инициализация Django, проектирование базы данных.</td>
                    </tr>
                    <tr>
                        <td>Неделя 2</td>
                        <td>Создание модели <code>Presentation</code>, загрузка тестовых презентаций, разработка страниц списка презентаций и detail view PDF.</td>
                    </tr>
                    <tr>
                        <td>Неделя 3</td>
                        <td>Реализация скачивания файлов, проверка функционала, исправление багов, подключение Bootstrap, настройка адаптивности.</td>
                    </tr>
                    <tr>
                        <td>Неделя 4</td>
                        <td>Документирование, финальные проверки, демонстрация Agile/Kanban, Git-логов и тестов, подготовка презентации проекта.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 4. Основные этапы -->
    <div class="glass-card mb-4 p-4">
        <h3 class="fw-semibold mb-3">Основные этапы</h3>
        <ul>
            <li><strong>Организационно-подготовительный этап:</strong> инициализация Django, настройка окружения, подключение репозитория Git.</li>
            <li><strong>Проектирование и разработка базы данных:</strong> создание модели <code>Presentation</code>, миграции, проверка загрузки PDF.</li>
            <li><strong>Реализация пользовательского функционала:</strong> страницы списка презентаций, просмотр и скачивание PDF.</li>
            <li><strong>Адаптация интерфейса:</strong> подключение Bootstrap, проверка адаптивности на разных разрешениях.</li>
            <li><strong>Тестирование и документация:</strong> автоматические тесты, проверка всех страниц, создание документации проекта.</li>
            <li><strong>Финализация проекта:</strong> демонстрация Agile/Kanban, Git-логов, итоговой работы, подготовка к защите.</li>
        </ul>
    </div>
</section>

<!-- Popup для увеличенного изображения -->
<div id="imagePopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
     background:rgba(0,0,0,0.8); z-index:1050; justify-content:center; align-items:center;">
    <div style="position:relative; max-width:90%; max-height:90%;">
        <button onclick="closeImagePopup()" style="position:absolute; top:10px; right:10px; z-index:10;" 
                class="btn btn-danger btn-sm">✖</button>
        <img id="popupImage" src="" style="width:100%; height:auto; border-radius:10px;">
    </div>
</div>

<style>
.carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 8px;
}

.carousel-indicators button.carousel-indicator {
    width: 12px !important;
    height: 12px !important;
    border-radius: 50% !important;
    background-color: rgba(255, 255, 255, 0.5);
    border: none;
}

.carousel-indicators button.carousel-indicator.active {
    background-color: rgba(255, 255, 255, 1);
}

.carousel-img {
    object-fit: cover;
    max-height: 200px;
}

.project-plan .glass-card {
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 1.5rem;
    backdrop-filter: blur(10px);
}

.project-plan h2, .project-plan h4 {
    color: #fff;
}

.project-plan p, .project-plan li {
    color: #e0e0e0;
    font-size: 0.95rem;
    line-height: 1.6;
}

.project-plan ul, .project-plan ol {
    padding-left: 1.2rem;
}

.card p, .card ul, .card ol, .card table {
    font-size: 0.95rem;
}

.glass-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}

/* Адаптация текста */
.card p, .card ul, .card ol, .card table, .glass-card p, .glass-card ul, .glass-card ol, .glass-card table {
    font-size: 0.95rem;
}

@media (max-width: 1024px) {
    .card p, .card ul, .card ol, .card table, .glass-card p, .glass-card ul, .glass-card ol, .glass-card table {
        font-size: 0.9rem;
    }
}

@media (max-width: 768px) {
    .card p, .card ul, .card ol, .card table, .glass-card p, .glass-card ul, .glass-card ol, .glass-card table {
        font-size: 0.85rem;
    }
    .display-6 {
        font-size: 1.5rem;
    }
}

@media (max-width: 375px) {
    .card p, .card ul, .card ol, .card table, .glass-card p, .glass-card ul, .glass-card ol, .glass-card table {
        font-size: 0.8rem;
    }
    .display-6 {
        font-size: 1.3rem;
    }
}
</style>

<script>
function openImagePopup(url) {
    document.getElementById('popupImage').src = url;
    document.getElementById('imagePopup').style.display = 'flex';
}

function closeImagePopup() {
    document.getElementById('popupImage').src = '';
    document.getElementById('imagePopup').style.display = 'none';
}
</script>

{% endblock %}